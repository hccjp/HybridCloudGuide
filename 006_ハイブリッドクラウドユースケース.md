# ハイブリッドクラウドユースケース

この章では典型的なハイブリッドクラウド利用のユースケースを紹介します。同時にどの「スタイル」に適合するものかも明示します。

**単一のユースケースが必ずしも単一のスタイルに適合するわけではないことに注意してください。** このユースケース集は多数のユースケースを集めて参考にすることができることを重視しており、その粒度はユースケースにより様々です。

なおユースケースは継続的に追加していくことを計画しています。

## レガシーシステムのクラウドネイティブ化

### 状況および課題

- 既存のレガシーシステムは手作業による操作が雑多で、属人性が高く、サービス要請ごとに大量の管理者が必要。人件費とシステムの運用費が高く、サービスインまでのリード時間が長い。
- 将来のITロードマップとして、IaaSだけでなく、PaaSも見据え、社内外のユーザーにより付加価値の高いサービスを提供するために、より俊敏性が高く、柔軟性の高いモダンなハイブリッドクラウド基盤が必要。

### 解決方法

- IT運用におけるルーティンワークなどの手作業をInfrastructure as codeで自動化する
- Dockerや Kubernetesといったコンテナ技術、Azure Functionsなどサーバーレスコンピューティングの開発手法を導入する。
- クラウドのような瞬時性・セルフサービス・自動化などのメリットを享受できるハイブリッドクラウドのプラットフォーム（例：Azure Stack）を導入する。

### 関連するスタイル

- [オンプレミス環境のみ(クラウドネイティブシステム)](./005_ハイブリッドクラウドスタイル.md#オンプレミス環境のみクラウドネイティブシステム)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)
- [クラウド環境のみ(クラウドネイティブシステム)](./005_ハイブリッドクラウドスタイル.md#クラウド環境のみクラウドネイティブシステム)

### 解説

このユースケースは特にオンプレミスシステム重視ですが、新しい社会ニーズをいち早く満たすために、システムにクラウドのスピードを取り入れたい場合に適しています。

従来のウォーターフォール型のシステム開発はかなり時間がかかることから、アプリの設計運用にクラウドのアーキテクチャを導入し、迅速なサービス展開を図りたいという企業が増えてきています。例えば、アプリをコンテナ化すれば異なるプラットフォーム間での移行も簡単にできることで、クラウドロックインを回避できます。サーバーレスアーキテクチャーなら、トリガーとなる関数コードを変更するだけで、インフラを意識することなくイベントドリブン型のアプリ開発ができます。

オンプレ側にもクラウドネイティブな技術を取り入れ、より迅速かつ柔軟に変化する社会ニーズに対応できるシステム基盤が求められています。

### 関連する技術

- Azure Stack
- ARM Template
- Azure Kubernetes Service
- Azure Functions

### 参考情報

- [事例：Visionet社（インドネシアの大手ITサービスプロバイダー）が真のハイブリッドクラウド基盤としてAzure Stackを導入](https://www.indotelko.com/kanal?c=id&it=multipolar-technolog-bisnis-cloud)
- [Azure Resource Manager テンプレートの構造と構文の詳細 | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/resource-group-authoring-templates)
- [AKS - Microsoft Azure](https://azure.microsoft.com/ja-jp/services/kubernetes-service/)
- [Azure Functions—サーバーレス アーキテクチャ | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/functions/)

## 機密データをオンプレミスに配置しパブリッククラウドとシームレスに連携

### 状況および課題

- 業界規制やコンプライアンス上、自社データや機密情報をオンプレに置きつつ、アプリなどのフロントエンドはパブリッククラウドを利用したい。必要に応じて、パブリック／オンプレ上のインスタンスをシームレスに拡張可能にしたい。
- オンプレミスとパブリッククラウドのアーキテクチャが違うと、運用の手間や、課金方式の違い、開発のコスト増などが懸念される。

### 解決方法

- パブリッククラウドと一貫性のある基盤をオンプレミスに導入し、同じ運用・開発手法によって二重管理を防ぎ、学習コストも最低限に抑えられる。

### 関連するスタイル

- [データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

このユースケースは特に政府公共、金融機関などセンシティブな情報を扱う企業に適しています。

昨今の環境変化において、パブリッククラウドの利用制限も緩和されつつあるが、パブリッククラウドに自社データを置くことができないエンタープライズ企業はまだ多くあります。また、パブリッククラウド特有のデータ転送料金やネットワーク課金があるため、大量のデータを抱える場合、データをパブリッククラウドに都度転送するとコストメリットが薄いというケースもあります。この際、データをオンプレのシステムに置き、クラウドでアジャイル開発したアプリとAPIで連携運用、継続的インテグレーション／継続的デリバリー（CI/CD）したりすることができます。

また、パブリッククラウドの定期メンテナンス期間によるサービスダウンを回避する策として、パブリック上で立てたワークロードをシームレスにオンプレミスに移行できるので、ビジネス上の機会損失を最低限にすることができます。

### 関連する技術

- Azure Stack

### 参考情報

- [事例：iMOKO社（ニュージーランドのデジタルヘルスプロバイダー）がAzure Stackを自社デジタル医療システムの基盤としてを採用](https://news.microsoft.com/en-nz/2018/08/22/imoko-azure-stack-microsoft-nz/)
-  [事例：ANZ Internet Banking (オーストラリア・ニュージーランド銀行)がAzure Stackを社内の処理基盤として採用](https://www.computerworld.com.au/article/630394/anz-deploys-azure-stack-keep-processing-house/)
- [Azure Stack 向けの開発](https://docs.microsoft.com/ja-jp/azure/azure-stack/user/azure-stack-developer)
- [Azure と Azure Stack にアプリをデプロイする](https://docs.microsoft.com/ja-jp/azure/azure-stack/user/azure-stack-solution-pipeline)
- [ハイブリッド クラウド アプリケーション](https://azure.microsoft.com/ja-jp/solutions/hybrid-cloud-app/)

## クラウドエッジ

### 状況および課題

- クラウドのサービスを活用したアプリケーションを実現したい
- 全てクラウドで実装することも可能だが、クラウドまでの距離による遅延や、大容量のデータを全てクラウドまでアップロードする際にかかる時間のためアプリケーションのパフォーマンスが悪くなりすぎてしまう。
- 場合によってはインターネットへの接続回線の品質が悪い、速度が遅すぎるケースもある。場合によっては断続的に接続されない状況になるケースも考えられる。
- 従来の仮想マシンベースのレガシーシステムで構築することも不可能ではないが、パブリッククラウドに存在しているリッチなサービスや開発手法を活用したい。

### 解決方法

- オンプレミス上にクラウドサービスのエッジとなるシステムを配置する。オンプレミス側で独立してシステムが稼働することが可能となるため遅延の問題は大幅に改善される。
- データ収集や処理はエッジシステムで行う。バックグラウンドで非同期的にクラウドサービスと連携し、追加の分析等を行う。これによりクラウドサービスのメリットも享受される。
- オンプレミス側でもクラウドのサービスや開発手法を活用するために、基盤にはAzure Stack等のクラウド基盤を導入する。

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

このユースケースは抽象度の高いユースケースですが、クラウド一辺倒では実現が難しいシステムの例と解決策を端的に表しているケースです。クラウド上のみにシステムを配置するだけでは生まれてしまう課題に対して、オンプレミス側に一部の役割をオフロードします。

適材適所のシステム配置を迅速に行うことはオンプレミス側がレガシーなシステムでは難しいことが多々あります。特にパブリッククラウドをメインで利用し、各種サービスを活用している状況ではそれが顕著です。このためオンプレミス側にもクラウドと極力同じことができる基盤が求められることになります。

### 関連する技術

- Azure Stack
- Azure IoT Edge

### 参考情報

- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [IoT Edge | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/iot-edge/)

## 高速な金融取引のためのハイブリッド構成

### 状況および課題

- 金融における高頻度な取引を独自のアルゴリズムを用いてミリ秒単位で速度を競う必要がある。
- クラウド上にシステムを配置すると遅延時間の関係で競合優位性が全く出せない。
- 速度的優位性がある場所は大都会の中心部であり土地が極めて高価である。

### 解決方法

- オンプレミスの速度的優位性がある場所に取引所利用のハードウェアおよびシステムを配置する。
- システム速度に影響しないコンポーネントはパブリッククラウドに配置することでオンプレミスの高価な場所の必要床面積を大幅に減らす。
- 分析および予測処理等はパブリッククラウドのAIサービスを利用する。

### 関連するスタイル

- [データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)
- [データセンター拡張(データもクラウド配置可能)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データもクラウド配置可能)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

このユースケースは「[クラウドエッジ](./006_ハイブリッドクラウドユースケース.md#クラウドエッジ)」のより具体的な一例です。オンプレミスにコンポーネントを配置する絶対的な価値と、パブリッククラウドのサービスを利用する価値があるがゆえに、最適構成を模索すると結果的にハイブリッドクラウド構成となる例です。

システムの具体的な構築方法には触れていませんが、目的を達成するために不必要な部分は極力排除したうえでクラウドネイティブなシステムとし、継続的にシステムを更新、改良し続けることで競合優位性を保ち、よりメリットが出せると考えられます。

### 関連する技術

- Azure
- Azure Stack
- Express Route

### 参考情報

- [Microsoft Azure Cloud Computing Platform & Services](https://azure.microsoft.com/ja-jp/?v=18.40)
- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [ExpressRoute - 仮想プライベート クラウド接続 | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/expressroute/)

## クラウド災害対策

### 状況および課題

- システム障害および災害対策のためにシステムの待機系を準備する必要があるが、待機系のための拠点を確保した上で、電源の確保、機器の購入、維持、管理等が必要なため有事の際にしかりようしない待機系のファシリティに対する高いコストが掛かっている
- 構築後の運用フェーズで継続的に管理を継続しながら「切り替えても問題ない」かつ「決められた RTO (目標復旧時間) および RPO(目標復旧時点)を担保している」状況を保持、確認し続けるための運用コストが高い。

### 解決方法

- 災害対策のための待機系としてオンプレミスにファシリティを持たず、有事の際には災害対策先としてパブリッククラウドを利用する。

### 関連するスタイル

- [クラウドを補完的に利用](./005_ハイブリッドクラウドスタイル.md#クラウドを補完的に利用)
- [データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)
- [データセンター拡張(データもクラウド配置可能)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データもクラウド配置可能)

### 解説

このユースケースは劇的なコストメリットを出すことができるユースケースです。実際に災害対策用に待機系のファシリティを保持、およびきちんと切り替えられる状態を保つのは非常に困難です。実際問題として、(縮退運転ではなく)完全に切り替えを行うためには待機系のシステムにも本番系のシステムと全く同じスペック、容量が必要となりますが、災害等発生しなければ単純に使われないシステムとなってしまいます。災害対策先としてクラウドおよびクラウドサービスを利用することで、ファシリティの準備や運用も必要なく、必要な時にのみ待機系に切り替えることが可能です。

災害対策システムの実装として、システムで構築されているサーバーや仮想マシンを、クラウド上のIaaS仮想マシンとして立ち上げておき、オンプレミスの本番システムとデータ同期する方法もありますが、Azure Site Recovery等の災害対策用のクラウドサービスを利用することで、IaaS仮想マシンを停止した状態でデータを同期、最新の状態に保持することができます。このことにより、待機系の維持コストを削減できる、というメリットを享受することができます。

また、上記のクラウドサービスを利用することで、本番システムとは完全に切り離した状態で「テスト」を実施することが非常に容易になります。このテストのための独立した環境も必要な時に必要なだけクラウドの環境上で展開することが可能となります。実際にパブリッククラウドを利用する際の「予行練習」としてテストできる容易さは特筆すべきものがあります。

ただし、Active DirectoryなどID機能に依存するシステムの場合、切り替え先のシステムがきちんとIDシステムと通信できる必要があります。加えて、切り替え先のシステムにきちんとアクセスできるよう、DNSの切り替えも必要となるケースがあるため、実際には切り替える際の事前準備や考慮、工夫が必要となります。

メリットをより活かすためにはシステムの認証システムとしてクラウドのIDサービスを採用し、クライアントのアクセス場所もインターネット経由にする等の構成が望ましいケースが多くあります。

「[クラウドを補完的に利用](./005_ハイブリッドクラウドスタイル.md#クラウドを補完的に利用)」「[データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)」のスタイルでクラウドを災害対策として使用する場合には、システムをクラウド上に配置すること、データをクラウドに配置することに関して利用ポリシーの整合性を取る必要があります。災害発生時のみクラウドの利用を許可するというポリシーが選択される事が多くあります。

### 関連する技術

- Azure Site Recovery
- Azure Backup
- Commvault
- Zerto

### 参考情報

- [Azure ディザスタ リカバリ サービス – Azure Site Recovery | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/site-recovery/)
- [クラウド バックアップ - サービスとしてのオンラインのクラウド バックアップ | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/backup/)
- [ディザスタ リカバリ | Commvault](https://www.commvault.com/ja-jp/solutions/by-topic/disaster-recovery)
- [Zerto仮想レプリケーション](https://www.zerto.com/jp/)

## Hybrid DevOps

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

-  [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- クラウドとオンプレミスに同一のクラウドネイティブなアプリケーションを継続的に展開したい。
- 継続的に開発と改善を行いたい。
- 開発者は同じツール、開発手法、コードを用いてクラウドの違いを意識する必要が無いようにしたい。
- 状況に応じてパブリッククラウドの利用もプライベートクラウドの利用も自由にコントロール可能な状況にしたい。

### 解決方法

- パブリッククラウドにAzureを、オンプレミスにAzure Stackを利用しHybrid DevOps環境を構築する。

![](media/image11.png)

引用元：[MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

1. アプリケーションコードおよびARMテンプレートを変更する
2. アプリケーションコードおよびARMテンプレートがAzure上のレポジトリにコミットされる
3. 自動的にアプリケーションが構築され、ユニットテストが実行される
4. アプリケーションが環境固有のパラメーターで自動展開される
5. アプリケーションがAzure上およびAzure Stack上のApp Serviceで実行される

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

![](media/image12.png)

引用元：[MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

- レポジトリおよびパイプラインにはAzure DevOps(Visual Studio Team Services)を利用します。
- それぞれの環境への認可のためにサービスプリンシパルを用います。
- Azure hostedのAzure DevOpsエージェントを用いることでビルドを高速にし、展開回数を多くすることが可能となります。
- Azureとエージェントとの間の接続性を担保する必要があります。オンプレミスのAzure Stackの環境に関してはインターネットからの接続を許可しないケースも多いと想定されますが、エージェントからインターネットへの一方向の接続のみで問題無ありません。
- 全ての利用サービスと利用OSイメージが両方の環境に存在している必要があります。Azure Stack側には必要に応じて追加のリソースプロバイダーをインストールし、サービスを利用可能とします。
- プロファイルを利用することで2つの環境への展開時の差異を最小化することができます。

### 関連する技術

- Azure DevOps
- Visual Studio
- App Service
- Web Apps
- Azure Resource Manager

### 参考情報

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)
- [Azure DevOps Services | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/devops/)
- [Visual Studio IDE、コード エディター、VSTS、App Center - Visual Studio](https://visualstudio.microsoft.com/ja/?rr=https%3A%2F%2Fwww.google.co.jp%2F)
- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)
- [Web App Service | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/web/)
- [Azure Resource Manager | Microsoft Azure](https://azure.microsoft.com/ja-jp/features/resource-manager/)

## データ主権とデータグラビティ

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- 法律あるいはプライバシーおよびコンプライアンスポリシーでデータの保管場所が規定されていて全てをパブリッククラウドに配置することができない。
- インターネットに向けて公開されたWebアプリケーションであり急激なユーザーアクセスの集中の可能性もあり、パブリッククラウドのスケールを使って処理したい。
- パブリッククラウドのサービス障害時にもサービスを継続したい。

### 解決方法

- アプリケーションとサービスをデータが存在するべき場所にあわせて配置する。
- 堅牢なアプリケーションをクラウドの境界を超えて配置する。
- 法規制、プライバシーおよびコンプライアンス要件に合致させる。

![](media/image13.png)

引用元：[MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

1. ユーザーはデータをAzureに配置されたWebアプリケーションで入力する。
2. WebアプリケーションはデータをVPN経由で仮想ネットワークが接続されたAzure Stack上のデータベースにコミットする。
3. データはAzure Stack上に配置された仮想マシン上のSQLデータベースに保存される。

### 関連するスタイル

- [データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

![](media/image14.png)

1. Azure上の仮想ネットワークとAzure Stack上の仮想ネットワーク内のサブネットに重複が無いことを確認します。アドレスの重複がある場合にはネットワークの接続ができません。
2. ARMテンプレートを利用してインフラを展開することで信頼性のある展開が可能になります。
3. オンプレミスのストレージが要件に合致していることを確認します。
4. Azure Stackがインターネットからルーティング可能である必要があります。
5. 強力な共有鍵を使用してVPNを構成します。あるいはExpress Routeを使用します。

### 関連する技術

- Azure App Service
- Azure Web App
- VPN Gateway
- Express Route
- Azure Resource Manager
- ARM Template

### 参考情報

- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)
- [Web App Service | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/web/)
- [VPN Gateway | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/vpn-gateway/)
- [ExpressRoute - 仮想プライベート クラウド接続 | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/expressroute/)
- [Azure Resource Manager | Microsoft Azure](https://azure.microsoft.com/ja-jp/features/resource-manager/)
- [Azure Resource Manager テンプレートの構造と構文 | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/resource-group-authoring-templates)
- [Azure クイック スタート テンプレート](https://azure.microsoft.com/ja-jp/resources/templates/)

## 分析のための階層化データ

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- 機密性の高いデータを扱うアプリケーションを動作させたい。
- オンプレミス上では機密性の高いデータから得られる情報を元にアプリケーションを動作させたい。
- パブリッククラウド上では匿名化されたデータに基づく情報を元にアプリケーションを動作させたい。
- オンプレミスのデータとパブリッククラウドのデータとは極力リソースを消費せずに必要な分だけ最小限のコストで連動させるようにしたい。
- パブリッククラウドのアプリケーションも高速に動作させる必要がある。オンプレミスまでデータを参照させに行くようなデザインは許容されない。
- オンプレミスとパブリッククラウド間のネットワーク接続は限定的であり、不安定である。場合によってはしばらく接続できないこともありうる。

### 解決方法

- データを最適化することで遅延問題への対策とします。 
- クラウドベースの開発モデルをデータが存在する場所に持ち込みます。
- ビジネスのための予測的な洞察をシステム全体に提供します。場所により適切な匿名化を行います。 

![](media/image15.png)

1. データがストレージアカウントに格納されます。
2. Azure Stack上のFunctionにてデータが分析されます。
3. プライベートのアプリケーションはローカルにあるデータを元に動作します。
4. 予測的な洞察は匿名化されキューに格納されます。
5. FunctionがデータをキューからAzureストレージに送信します。
6. Azure上の公開されたアプリケーションには匿名化されコンプライアンス的にも問題ない予測的な洞察が公開されます。

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

![](media/image16.png)

1. アプリケーションコード作成時には断続的にしかインターネットに接続されない状況や完全に切り離された状況にも対応可能なように計画します。
2. コンプライアンスに合致するようにAzure上のデータは暗号化されて格納されます。
3. Azure FunctionsおよびApp Serviceを用いてアプリケーションは適切にスケールするように構成されます。

### 関連する技術

- Azure Functions
- Azure App Service
- Azure Stack

### 参考情報

- [Azure Functions—サーバーレス アーキテクチャ | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/functions/)
- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)
- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [Queue Storage | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/storage/queues/)

## エッジAI

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- AIを用いた分析を行いたい。
- 実際にAIを利用したい場所はオンプレミス。
- システムとして極力早いレスポンスを得たい。

### 解決方法

- AIとコンピューティングパワーをデータが生成される場所に配置します。
- モデルのトレーニングはパブリッククラウドのスケールを活用して行い、生成したモデルはエッジ(オンプレミス)に配置します。
- エッジにて処理を行うことですばやく結果を得ることを可能にする。

![](media/image17.png)

1. モデルはAzureマシンラーニングを用いてトレーニングされ、コンテナ化されます。
2. モデルはAzure Stack上のKubernetesクラスタに展開されます。
3. 入力はコンテナ上のモデルによってオンプレミスで独立してスコア付けされます。
4. スコアから得られた予測的な洞察はキューに格納されます。
5. Azure上に送信する際にデータは匿名化されコンプライアンス的に問題無い状態となり格納されます。
6. Azure上の公開されたアプリケーションには匿名化されコンプライアンス的にも問題ない予測的な洞察が公開されます。
7. エッジにてスコア付けされたデータはモデルの改善に利用されます。

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

![](media/image18.png)

1. KubernetesがAzure Stack上に展開され、適切にネットワークが構成されている必要があります。
2. データのアップロードや新しいモデルの展開時に使用するインターネット接続が信頼できないものであるケースも考慮に入れて計画可能です。
3. Azure上のモデルトレーニングのためのクラスタは適切にスケールさせます。
4. スコアリングするアプリケーションが適切にDoS攻撃から保護されていることを確認します。

### 関連する技術

- Azure Stack
- Azure Machine Learning
- Azure Container Service
- Azure Kubernetes Service
- Azure App Service
- Azure Functions
- Azure Container Registry
- Azure IoT Edge

### 参考情報

- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [Machine Learning | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/machine-learning-studio/)
- [Container Service](https://azuremarketplace.microsoft.com/ja-JP/marketplace/apps/microsoft.acs)
- [Azure Kubernetes Service (AKS) | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/kubernetes-service/)
- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)
- [Azure Functions—サーバーレス アーキテクチャ | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/functions/)
- [Azure Container Registry – Docker Registry | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/container-registry/)
- [IoT Edge | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/iot-edge/)

## 地域分散アプリケーション

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- サーバーレス、マイクロサービス等を取り入れた最新のアプリケーションを世界展開したい。
- 地域ごとに異なるデータ保護要件がありパブリッククラウドを利用できる地域とできない地域がある。

### 解決方法

- AzureとAzure Stackを用いてモダンなサーバーレスアプリケーションとマイクロサービスをグローバルに展開する。
- AzureとAzure Stackを用いることで同一のアプリケーションをコード変更無しで展開可能とする。
- 世界中のユーザーにコンプライアンス要件に合致したサービスを提供する。
- Azureサービスとのシームレスな接続を可能とし、世界中のユーザーが同一のURLでアプリケーションにアクセス可能とする。

![](media/image19.png)

1. ユーザーがアプリケーションにアクセスします。
2. DNSがAzure Traffic Managerにクエリします。
3. Traffic Managerがユーザーに最も近いAzure上またはAzure Stack上のアプリケーションを返します。

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

![](media/image20.png)

1. SSL証明書とドメイン名が適切に構成されている必要があります。
2. このソリューションはスケーラビリティの観点では記載していませんが、スケーラビリティの観点でのソリューションとすることも可能です。
3. 6.6 Hybrid DevOpsで解説したハイブリッドパイプラインを用いて確実にアプリケーションを全てのクラウドに展開します。
4. アプリケーションコードと位置情報を用いて適切にユーザーを適切なアプリケーションにルーティングします。

### 関連する技術

- Azure Stack
- Azure Front Door
- Azure Traffic Manager
- Azure App Service

### 参考情報

- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [Azure Front Door Service | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/frontdoor/)
- [Traffic Manager - クラウドベースの DNS 負荷分散 | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/traffic-manager/)
- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)

## 医療機関Webサイト

このユースケースは下記で紹介されているハイブリッドアプリケーションパターンからの紹介です。

- [MyIgnite - Understanding hybrid application patterns for Microsoft Azure Stack](https://myignite.techcommunity.microsoft.com/sessions/66254)

### 状況および課題

- 医療データは非常に機密性が高く、オンプレミスに配置する必要がある。
- Webサイトは非常に高い可用性を実現しつつ高負荷にも耐えられる必要がある。
- 開発者は上記要件を実現するためであっても極力無駄な工数は省き、一括でアプリケーションを展開可能としたい。

### 解決方法

![](media/image21.png)

1. ユーザーは自動的に最もコンプライアンスに合致したクラウドに誘導される。
2. データはオンプレミスのAzure Stack上に保存される。
3. 開発者はハイブリッドなCI/CDパイプラインを利用し、アプリケーションを一貫性ある方法で展開する。

### 関連するスタイル

- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

医療機関のような機微なデータを取り扱うシステムにおいては、データはオンプレミスでかつ堅牢性が担保される必要があります。

利用者側からの観点からはネットワーク遅延を意識せずストレスフリーなユーザーエクスペリエンスを享受でき、開発者側からの観点からはAzureとAzure Stackの違いを意識する事なくWebアプリケーションの開発にフォーカスする事を可能にしました。

### 関連する技術

- Azure Stack
- Azure Traffic Manager
- Azure DevOps
- Azure App Service

### 参考情報

- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)
- [Traffic Manager - クラウドベースの DNS 負荷分散 | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/traffic-manager/)
- [Azure DevOps Services | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/devops/)
- [Azure App Service - アプリのホスティング | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/app-service/)

## Oracleデータベースのマルチクラウド利用

### 状況および課題

- 既存システム（オンプレミス環境）のクラウドサービス利用を計画している。
- データベースはOracleを利用している。
- クラウドサービスの利用に当たってはOracleライセンス規約に抵触しないように注意する必要がある。
- 社内のセキュリティポリシーからデータベースは仕様・構成を把握できる環境に配置する必要がある。

### 解決方法

![](media/image22.png)

- OracleサーバーはOracleライセンス規約及びセキュリティポリシーに準拠する必要があるため、オンプレミス環境に残す。
- アプリケーションサーバーなど関連システムはクラウドサービスもしくはメガクラウドに移行する。
- オンプレミス環境＋クラウドサービス環境＋メガクラウド間は閉域ネットワーク接続サービスを利用し、場所を意識することなくシームレスに通信できるようにする。
- DBサーバーとの通信量が多いサーバ（アプリケーションサーバーなど）は距離的にオンプレミス環境に近いクラウドサービスの利用が望ましい。（同一構内であることが望ましい。）

### 関連するスタイル

- [データセンター拡張(データはオンプレミス)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データはオンプレミス)
- [データセンター拡張(データもクラウド配置可能)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データもクラウド配置可能)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

クラウドサービスの利用を推進していく中で、Oracleライセンス規約の準拠と機密情報の信頼できる場所への保管は最後まで課題として残るケースが多いと言えます。またコストで担保できる要件でも無いことから現実的にはオンプレミス環境に残すという選択を取るケースが大半であると考えられます。

このケースではデータベースとアプリケーションサーバー間の通信が遅延時間や応答時間に影響を与えることになり、実際のシステム利用に耐えられるかがポイントになります。

オンプレミス環境とパブリッククラウド環境が同一構内にある場合はローカル接続と同等の性能を出すことが可能になると言えるが、WANを経由する場合には広帯域をサポートしている閉域ネットワーク接続サービスの利用が考えられるが、遅延時間や応答時間がシステム利用に十分に耐えられるかを見極める必要があります。

### 関連する技術

- Azure Express Route

### 参考情報

- [ExpressRoute - 仮想プライベート クラウド接続 | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/expressroute/)

## クラウドによるオンプレミスDBの分析と可視化

### 状況および課題

- OracleサーバーはOracleライセンス規約及びセキュリティポリシーを準拠する必要があるため、オンプレミス環境に残す必要がある。
- 分析・可視化システムはクラウドサービスを有効につかって構築したい。

### 解決方法

![](media/image23.png)

- OracleサーバーはOracleライセンス規約及びセキュリティポリシーを準拠する必要があるため、オンプレミス環境に残す。
- 分析・可視化システムはクラウドサービス上に新規に構築する。
- Azure Data Factoryを利用して既存データベースからのデータ収集、処理、変換を行い、データウェアハウスに分析用のデータを格納する。
- データウェアハウスとしてAzure SQL Data Warehouseを利用し、分析・可視化システムでデータを活用できるようにする。

### 関連するスタイル

- 5.5 データセンター拡張(データもクラウド配置可能) (40ページ)
- 5.6　ハイブリッドなクラウド基盤を利用したシステム(42ページ)

### 解説

Azure Data Factoryはデータ保存や処理、移動といったサービスを効率的かつスケーラブルで信頼性の高いデータ生成パイプラインとして構成、利用することができます。

主な機能は以下の通り。

- オンプレミスやクラウドサービスから取得したデータを結合、集計、変換するデータ主導のワークフロー（パイプライン）構築
- 様々なデータソース（半構造化、非構造化、構造化）の信頼できる情報への変換
- ビジネスインテリジェンス（BI）、分析ツール、その他のアプリケーションで容易に使用できるデータの生成
- JSONスクリプトによる複雑なデータ処理の設定
- Azureプレビューポータルが提供するUIによるパイプラインの監視と管理

Azure SQL Data Warehouseは、超並列処理（MPP）を利用して、ペタバイト単位のデータに対して複雑なクエリを短時間で実行することができるクラウドベースのエンタープライズデータ ウェアハウス（EDW）です。

データウェアハウスのような大規模なデータ基盤はオンプレミスで構築する選択肢もちろんありますが、パブリッククラウド上のサービスを利用することでスケールを担保し、スモールスタートを開始するということも有力な選択肢です。このユースケースのようにオンプレミスでこれまで利用していたデータベースに対してのデータウェアハウスと分析基盤をパブリッククラウド上に保持し、そのデータ連携もクラウドサービスを利用するというパターンはデータの扱いに関しての典型的なユースケースの1つです。

### 関連する技術

- Azure Data Factory
- Azure SQL Data Warehouse
- Azure Analysis Service

### 参考情報

- [Data Factory - データ統合サービス | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/data-factory/)
- [SQL Data Warehouse – Azure SQL 用 ソリューション | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/sql-data-warehouse/)

## EAI利用によるクラウドをまたいだデータの利活用

### 状況および課題

- オンプレミス環境にある既存データベースの利活用を図りたい。
- 既存システムはオンプレミス環境やクラウドサービス環境に分散している。
- クラウドサービスの利用に当たってはOracleライセンス規約に抵触しないように注意する必要がある。
- 社内のセキュリティポリシーからデータベースは仕様・構成を把握できる環境に配置する必要がある。

### 解決方法

![](media/image24.png)

- OracleサーバーはOracleライセンス規約及びセキュリティポリシーを準拠する必要があるため、オンプレミス環境に残す。
- データ連携ツール(EAI)を利用し、オンプレミス環境、クラウドサービス環境に分散しているシステムと既存データベースを連携させる。

### 関連するスタイル

- [データセンター拡張(データもクラウド配置可能)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データもクラウド配置可能)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

業務システムのクラウド化が進み、クラウドサービスとオンプレミス環境間のデータ連携、あるいはクラウドサービス間でのデータ連携が必要不可欠になってきています。

しかし、システム連携を行うにはプログラミング開発を伴うケースが多く、システムによってはプログラミング開発負荷が非常に高い、もしくは困難となるケースも多いと言えます。

このような課題を解決する手段として、データ連携ツールの利用が考えられます。

AWS（Amazon Web Service）やMicrosoft Azure、Google Appsなどのクラウド上に置いたシステムとオンプレミス環境にある既存システムとの連携やデータの活用を図ることが容易に可能となります。

### 関連する技術

- EAI(Enterprise Application Integration)

### 参考情報

- [DataSpider Servista V4](https://www.appresso.com/servista/campaign/1192501_1941.html)
- [ASTERIA Warp](https://www.asteria.com/jp/warp/)

## ファイルサーバーのスモールスタートとハイブリッド化

### 状況および課題

- 業務システムで使用するファイル サーバーを新規に準備する必要がある。
- 予算の都合上、すぐにファイルサーバーを既存システムに追加することが難しく、どの程度容量を使用するかどうか判断できない。
- 今後、オンプレミス上にファイルサーバーを導入した際に、効率よくデータアクセスや容量を扱いたい。
- 機密情報を取り扱う予定があるため、適切なアクセス権を設定する必要がある。

### 解決方法

- 使用した容量分だけ料金が発生するクラウドストレージサービスを利用する。
- データ連携ツールを用いて、オンプレミス上のファイルサーバーを連携、使用頻度の高いファイルはオンプレミスに、低いファイルはクラウドに、といったデータ階層化を行う。
- クラウドのディレクトリ機能を用いてアクセス権を設定し、データ連携ツールを用いている場合は、オンプレミスのディレクトリサーバーと連携しアクセス権を設定する。

### 関連するスタイル

- [データセンター拡張(データもクラウド配置可能)](./005_ハイブリッドクラウドスタイル.md#データセンター拡張データもクラウド配置可能)
- [ハイブリッドなクラウド基盤を利用したシステム](./005_ハイブリッドクラウドスタイル.md#ハイブリッドなクラウド基盤を利用したシステム)

### 解説

業務を早急に行うためには、利用するための機器を準備する必要がありますが、容量などリソースのサイジングや、そのサイジング結果に合わせた機器の選定などで時間を要することが往々にしてあります。

まずはスモールスタートとして使ってみる、ということであればCommon Internet File System (CIFS)やServer Message Block (SMB)プロトコルを介してアクセス可能な、ファイル共有型のクラウドストレージサービスの利用が考えられます。

ファイル共有型のクラウドストレージサービスは、利用した分だけ料金が発生するため、あらかじめ容量のサイジングや、ハードウェアの購入は必要ありません。また、クラウドベンダーにもよりますが、アクセスする際のデータ暗号化やクラウドのディレクトリ機能を用いてアクセス権を設定することも可能なため、セキュリティ面での不安はないと言えます。

加えて、データの複製、スナップショットやバックアップといったマネージドサービスを提供しているクラウドベンダーも出てきており、従来のオンプレミスファイルサーバー運用と比較して、運用の手間やコストを低減することも可能となっています。

クラウドストレージサービスを利用したファイルサーバー利用の懸念点としては、基本的にインターネット経由でのアクセスとなるため、ファイル応答速度がオンプレミスよりも低下する点があります。回避策としては、専用線を用いることも可能ですが、オンプレミスファイルサーバーとデータ連携ツールを用いて、データ階層化を行うことでも可能と考えられます。データ階層化は、オンプレミスファイルサーバーのストレージ容量を拡張するだけでなく、使用頻度の高いファイルはオンプレミスに、低いファイルはクラウドに、と使い方が可能であるためです。

最後に、データ連携ツール (Azure File Sync)を用いてオンプレミスのファイルサーバーとクラウドストレージサービスが連携している場合、オンプレミスのディレクトリ機能を用いてアクセス権を設定することが可能となっています。そのため、利用者観点で見ると従来のオンプレミスファイル サーバーと同様に使用することが可能となっています。

### 関連する技術

- Azure Files
- Azure File Sync
- AWS Storage Gateway

### 参考情報

- [File Storage | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/storage/files/)
- [AWS Storage Gateway（オンプレミスをクラウドと接続するハイブリッドストレージ）｜AWS](https://aws.amazon.com/jp/storagegateway/)

## ログ収集および分析基盤のクラウド上への構築

### 状況および課題

- 全てのシステムにおいて適切に必要なログが収集されなくてはいけない。
- どれだけのログが発生し、収集、補完する必要があるのかを正確に見積もることは難しい。
- 必要な最大サイズのログを補完可能なログ保管システムをシステム構築当初から用意しておくのは無駄が大きい。
- ログ収集、分析システム基盤の維持のための仮想マシン、ストレージシステム等の維持管理に負荷がかかる。
- 収集したログが収集するだけとなってしまい、活用できていない。
- 収集したログの量が増えると必要な際に単純に検索をしようとするだけでも長い時間がかかってしまう。現実的にログの活用を進めることが難しい。

### 解決方法

- ログ収集および分析基盤としてクラウド上のサービスを利用する
- ログはクラウド上で収集、分析を行う

### 関連するスタイル

- [クラウドを補完的に利用](./005_ハイブリッドクラウドスタイル.md#クラウドを補完的に利用)

### 解説

ログ収集システムは想定により容易に巨大なシステムとなり、それをオンプレミスに作成、維持することはその投資に対してリターンが少ないことが多い。法令や組織のルールで縛られ何年間もログを大量にためることを行うが、実際には「データを保持している」というアリバイ作りに終始し、現実的に利用できないシステムになってしまっているケースも多い。

クラウド上のログ収集、分析サービスの利用はスモールスタートで始められ、従量課金のためコストも安く、データの可視化や他システムとの連携も容易である。

オンプレミスであれば必要となってくるログ収集および分析のためのサーバーやストレージシステムも不要であり、管理も必要ない。サイジングすらも不必要となる。

ログを貯めるだけではなく、蓄積したログからの可視化やAIによる修正アドバイスの提示等、クラウドサービスを利用することによるメリットは大きい。

### 関連する技術

- Azure Monitor
- Azure Log Analytics

### 参考情報

- [Azure Monitor の概要 | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/azure-monitor/overview)
- [Azure Monitor での Log Analytics データの分析 | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/log-analytics/log-analytics-queries)

## 自動処理のクラウド化

### 状況および課題

- 日々自動的に定期実行するタスクや都度実行するタスク等がある。
- 個々人でそれぞれスクリプトを記述する等部分的な自動化がなされている領域もあるし、全くなされていないものもあり品質にバラつきがある。
- タスクを自動的に定期実行させるためだけに可動させ続けるサーバーがあり、OSのアップグレードや障害対応等の運用タスクが必要となっているが、可動していない時間が大部分である。

### 解決方法

- クラウド上でロジック、スクリプト等を管理及び共有する。
- 定期的な実行、アドホックな実行含めてクラウドサービスにて実行させる

### 関連するスタイル

- [クラウドを補完的に利用](./005_ハイブリッドクラウドスタイル.md#クラウドを補完的に利用)

### 解説

自前で基盤を保持および維持管理せずにクラウド上にコードを保持させクラウド上で実行させることが可能です。オンプレミス上の特定のサーバー上で実行しなければいけないような処理に関しても、例えばAzure Automationであれば「ハイブリッドワーカー」という仕組みで実行させることが可能です。

加えてクラウド上に配置することで特定のイベント発生時に自動で処理を開始させることや、クラウド上の他の自動処理をキックすることや他のサービスと連携させることも容易にできるようになります。大規模なリソースが必要なケースでもクラウド側で自動的にスケールさせてくれるサービスもある、災害対策にも強くなる等、使った分だけの従量課金でありコスト削減となる等、クラウド化による様々なメリットが得られます。

### 関連する技術

- Azure Automation
- Azure Functions
- Azure AppService(Webジョブ)

### 参考情報

- [Azure Automation – クラウド オートメーション サービス | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/automation/)
- [Azure Functions—サーバーレス アーキテクチャ | Microsoft Azure](https://azure.microsoft.com/ja-jp/services/functions/)
- [Azure App Service で Web ジョブを使用してバックグラウンドタスクを実行する | Microsoft Docs](https://docs.microsoft.com/ja-jp/azure/app-service/web-sites-create-web-jobs)

## プライベートクラウド構築作業からの解放

### 状況および課題

- オンプレミスに仮想基盤あるいはプライベートクラウド基盤を構築している。
- 環境の構築、運用、保守、定期的なバージョンアップ、拡張作業等含めて多くの人数と多くの工数を使っている。
- 基盤への定期的なセキュリティ更新プログラムの適用だけでも膨大な工数が必要となってしまい、適用頻度が低くセキュリティ上問題がある。
- 最新の技術や最新OSがサポートさせる状況に基盤を維持し続けることができていない。

### 解決方法

- 統合システムとしてAzure Stackを導入する。
- 構築作業は高度に標準化、自動化されており、OEMベンダーによって実施される。
- 基盤更新作業は管理ポータルからUpdateボタンをクリックするのみで完全に自動化されている。テナントのサービスへの影響も最小化されている。
- Update作業を継続的に実施することで、基盤自体も進化し続ける。

### 関連するスタイル

- [オンプレミス環境のみ(クラウドネイティブシステム)](./005_ハイブリッドクラウドスタイル.md#オンプレミス環境のみクラウドネイティブシステム)

### 解説

オンプレミスに仮想基盤を超えるプライベートクラウドを構築し、運用、更新し続けることは非常に大変な業務であり技術力も工数も必要です。パブリッククラウドを利用すれば何も考慮しなくてもよい部分も多く、パブリッククラウドの採用も1つの手ですが、本書でも解説している通り様々な理由でオンプレミス上にのこるシステムは多くあります。

オンプレミスのプライベートクラウドにもパブリッククラウドと同じ考え方を適用スルならば、重要なのは基盤自体の構築、運用ではない部分であり、任せられる部分は極力任せるという方針も選択肢となるでしょう。

Azure Stackであればプライベートの構築および更新の手順が完全に確立され、固定化されており、システムを「作る」ことから開放され、「使う」事に集中できます。

### 関連する技術

- Azure Stack

### 参考情報

- [Azure Stack とは | Microsoft Azure](https://azure.microsoft.com/ja-jp/overview/azure-stack/)